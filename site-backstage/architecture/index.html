
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../onboarding/">
      
      
        <link rel="next" href="../governance/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Architecture - Capability API Governance</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#architectural-guide-capability-api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Capability API Governance" class="md-header__button md-logo" aria-label="Capability API Governance" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Capability API Governance
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Architecture
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Capability API Governance" class="md-nav__button md-logo" aria-label="Capability API Governance" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Capability API Governance
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Overview
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../onboarding/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Onboarding
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Architecture
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#system-context-c4-level-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        System Context (C4 Level 1)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#containers-c4-level-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Containers (C4 Level 2)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#port-adapter-mappings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Port &amp; Adapter Mappings
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#module-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Module Documentation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-principles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Principles
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../governance/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Governance
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../policy-verification/latest/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Policy Verification
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#system-context-c4-level-1" class="md-nav__link">
    <span class="md-ellipsis">
      
        System Context (C4 Level 1)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#containers-c4-level-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        Containers (C4 Level 2)
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#port-adapter-mappings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Port &amp; Adapter Mappings
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#module-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Module Documentation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-principles" class="md-nav__link">
    <span class="md-ellipsis">
      
        Core Principles
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="architectural-guide-capability-api">Architectural Guide: Capability API<a class="headerlink" href="#architectural-guide-capability-api" title="Permanent link">&para;</a></h1>
<p>This document provides a high-level overview of the HR AI Platform's Capability API system design.</p>
<h2 id="system-context-c4-level-1">System Context (C4 Level 1)<a class="headerlink" href="#system-context-c4-level-1" title="Permanent link">&para;</a></h2>
<p>The Capability API serves as the central orchestration layer between AI Agents/HR Applications and external HR systems like Workday.</p>
<pre class="mermaid"><code>C4Context
  title System Context diagram for Capability API
  
  Person(agent, "AI Agent", "Automated reasoning engine requesting HR actions")
  Person(admin, "HR Admin", "Human user managing policies and workflows")
  
  System(capapi, "Capability API", "Governed surface exposing deterministic actions and flows")
  System(backstage, "Backstage", "Governance lens and catalog")
  
  System_Ext(workday, "Workday", "Core HRIS containing employee and payroll records")
  System_Ext(okta, "Okta", "Identity Provider for OIDC authentication")

  Rel(agent, capapi, "Invokes Actions/Flows", "HTTPS/JSON + JWT")
  Rel(admin, capapi, "Manages Policies", "YAML/CLI")
  Rel(admin, backstage, "Inspects Governance", "HTTPS/Web")
  
  Rel(capapi, workday, "Integrates with", "REST API")
  Rel(capapi, okta, "Validates Tokens against", "JWKS")
  Rel(backstage, capapi, "Reads Metadata", "Git/YAML")</code></pre>
<h2 id="containers-c4-level-2">Containers (C4 Level 2)<a class="headerlink" href="#containers-c4-level-2" title="Permanent link">&para;</a></h2>
<p>The system follows a <strong>Hexagonal Architecture</strong> (Ports and Adapters) to ensure the core business logic remains isolated from infrastructure concerns.</p>
<pre class="mermaid"><code>C4Container
  title Container diagram for Capability API
  
  Container_Boundary(api_boundary, "API Layer") {
    Container(routes, "API Routes", "FastAPI", "Request handling and Auth injection")
  }

  Container_Boundary(core_boundary, "Protected Domain Core") {
    Container(action_service, "Action Service", "Python", "Policy evaluation and action routing")
    Container(flow_service, "Flow Service", "Python", "Workflow orchestration")
    Container(policy_engine, "Policy Engine", "Python", "Capability-based authorization logic")
  }

  Container_Boundary(adapter_boundary, "Implementation Adapters") {
    Container(workday_adapter, "Workday Adapter", "Python", "Simulated or Real Workday connector")
    Container(auth_adapter, "Auth Adapter", "Python", "Token verification logic")
    Container(fs_adapter, "Filesystem Adapter", "Python", "Local storage for policies and flows")
    Container(mcp_server, "HR MCP Server", "FastMCP 3.0", "AI-agent gateway with RBAC")
  }

  Container(backstage, "Backstage", "Backstage.io", "Visualizes catalog and verification reports")

  Rel(mcp_server, routes, "Invokes", "HTTPS/JSON")

  Rel(routes, action_service, "Calls", "Internal")
  Rel(routes, flow_service, "Calls", "Internal")
  
  Rel(action_service, policy_engine, "Uses", "Logic")
  
  Rel(action_service, workday_adapter, "Uses", "Connector Port")
  Rel(flow_service, fs_adapter, "Uses", "Flow Runner Port")
  Rel(routes, auth_adapter, "Uses", "Token Verifier Port")

  Rel(backstage, fs_adapter, "Reads catalog-info.yaml", "Static Files")</code></pre>
<h2 id="port-adapter-mappings">Port &amp; Adapter Mappings<a class="headerlink" href="#port-adapter-mappings" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Port (Interface)</th>
<th>Adapter (Implementation)</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ConnectorPort</code></td>
<td><code>WorkdaySimulator</code></td>
<td>External HR system integration</td>
</tr>
<tr>
<td><code>FlowRunnerPort</code></td>
<td><code>LocalFlowRunnerAdapter</code></td>
<td>Long-running process execution</td>
</tr>
<tr>
<td><code>PolicyLoaderPort</code></td>
<td><code>FilePolicyLoaderAdapter</code></td>
<td>Policy document persistence</td>
</tr>
<tr>
<td><code>TokenVerifier</code></td>
<td><code>MockTokenVerifier</code></td>
<td>Identity validation</td>
</tr>
</tbody>
</table>
<h2 id="module-documentation">Module Documentation<a class="headerlink" href="#module-documentation" title="Permanent link">&para;</a></h2>
<p>For detailed information on specific system components, refer to the following module guides:</p>
<ul>
<li><strong><a href="../modules/api_layer/">API Layer</a></strong>: Entry points, routing, and dependencies.</li>
<li><strong><a href="../modules/domain_entities/">Domain Entities</a></strong>: Core data models and audit protocols.</li>
<li><strong><a href="../modules/auth_adapter/">Auth Adapter</a></strong>: OIDC simulation and token verification.</li>
<li><strong><a href="../modules/workday_adapter/">Workday Simulator</a></strong>: Simulated HRIS implementation (HCM, Time, Payroll).</li>
<li><strong><a href="../modules/filesystem_adapter/">Filesystem Adapter</a></strong>: Policy loading and flow execution.</li>
<li><strong><a href="../modules/policy_verification/">Policy Verification</a></strong>: Declarative security testing and compliance reporting.</li>
<li><strong><a href="../backstage/">Backstage Integration</a></strong>: Governance lens and capability catalog.</li>
</ul>
<h2 id="core-principles">Core Principles<a class="headerlink" href="#core-principles" title="Permanent link">&para;</a></h2>
<ol>
<li><strong>The Sanctuary</strong>: The <code>domain/</code> directory MUST NOT import from <code>adapters/</code> or <code>api/</code>.</li>
<li><strong>Deterministic Actions</strong>: All actions must have explicit Pydantic schemas and predictable outcomes.</li>
<li><strong>Audit by Design</strong>: Every operation generates provenance metadata tracked via the <code>ActionResponse</code>.</li>
</ol>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../onboarding/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Onboarding">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Onboarding
              </div>
            </div>
          </a>
        
        
          
          <a href="../governance/" class="md-footer__link md-footer__link--next" aria-label="Next: Governance">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Governance
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["navigation.footer", "content.action.edit"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../search/main.js"></script>
      
    
  </body>
</html>