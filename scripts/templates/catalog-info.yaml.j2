apiVersion: backstage.io/v1alpha1
kind: API
metadata:
  name: {{ capability.id }}
  title: {{ capability.name }}
  description: "{{ capability.description or '' }}"
{% if capability.tags %}
  tags:
{% for tag in capability.tags %}
    - {{ tag }}
{% endfor %}
{% endif %}
  annotations:
    capability-api/domain: {{ capability.domain }}
    capability-api/sensitivity: {{ capability.sensitivity }}
    capability-api/requires-mfa: "{{ capability.requires_mfa | lower }}"
{% if governing_policies %}
    capability-api/governed-by: {{ governing_policies | join(', ') }}
{% endif %}
  links:
    - title: Policy Verification
      url: http://localhost:3000/docs/default/component/capability-api/governance
      icon: dashboard
spec:
  type: openapi
  lifecycle: production
  owner: platform-engineering
  system: {{ capability.domain.split('.')[0] }}-{{ capability.domain.split('.')[1] if '.' in capability.domain else 'misc' }}
  definition: |
    openapi: 3.0.0
    info:
      title: {{ capability.name }}
      description: {{ capability.description or "" }}
      version: 1.0.0
    paths:
      /{action}:
        post:
          summary: {{ capability.name }}
          operationId: {{ capability.id | replace('.', '_') }}
          tags:
    {% if capability.tags %}
    {% for tag in capability.tags %}
            - {{ tag }}
    {% endfor %}
    {% endif %}
          responses:
            '200':
              description: Successful operation
